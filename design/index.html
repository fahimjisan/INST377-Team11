<!-- App can be found at: https://boiling-anchorage-15365.herokuapp.com/ -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="author" content="Malay Kalavadia, Rina Kim, Fahim Talukder, Jessica Tsai" />
  <title>Team 11</title>
  <link href="styles.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Staatliches&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Architects+Daughter&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Yellowtail&display=swap" rel="stylesheet">
</head>
<body>
  <div class="header">
    <h1>Predicting Next Hits</h1>
    <nav>
      <ul>
        <li><span>Home</span></li>
        <li><a href="project_content.html">Project Content</a></li>
        <li><a href="about_us.html">About Us</a></li>
      </ul>
    </nav>
  </div>

  <div class="wrapper">
    <div class="container">

      <h1>Search for an Artist</h1>
      <p>Type an artist name and click on "Search". Then, click on any album from the results to play 30 seconds of its first track.</p>
      <form id="search-form">
        <input type="text" id="query" value="" class="form-control" placeholder="Type an Artist Name"/>
        <input type="submit" id="search" class="btn btn-primary" value="Search" />
      </form>
      <div id="results"></div>
    </div>

    <script id="results-template" type="text/x-handlebars-template">
      {{#each albums.items}}
      <div style="background-image:url({{images.0.url}})" data-album-id="{{id}}" class="cover"></div>
      {{/each}}
    </script>

  </div>

  <script>
  // find template and compile it
  let templateSource = document.getElementById('results-template').innerHTML,
  template = Handlebars.compile(templateSource),
  resultsPlaceholder = document.getElementById('results'),
  playingCssClass = 'playing',
  audioObject = null;

  let fetchTracks = function (albumId, callback) {
    $.ajax({
      url: 'https://api.spotify.com/v1/albums/' + albumId,
      success: function (response) {
        callback(response);
      }
    });
  };

  let searchAlbums = function (query) {
    $.ajax({
      url: 'https://api.spotify.com/v1/search',
      data: {
        q: query,
        type: 'album'
      },
      success: function (response) {
        resultsPlaceholder.innerHTML = template(response);
      }
    });
  };

  results.addEventListener('click', function (e) {
    let target = e.target;
    if (target !== null && target.classList.contains('cover')) {
      if (target.classList.contains(playingCssClass)) {
        audioObject.pause();
      } else {
        if (audioObject) {
          audioObject.pause();
        }
        fetchTracks(target.getAttribute('data-album-id'), function (data) {
          audioObject = new Audio(data.tracks.items[0].preview_url);
          audioObject.play();
          target.classList.add(playingCssClass);
          audioObject.addEventListener('ended', function () {
            target.classList.remove(playingCssClass);
          });
          audioObject.addEventListener('pause', function () {
            target.classList.remove(playingCssClass);
          });
        });
      }
    }
  });

  document.getElementById('search-form').addEventListener('submit', function (e) {
    e.preventDefault();
    searchAlbums(document.getElementById('query').value);
  }, false);
</script>

<!-- <script>
document.body.addEventListener('submit', async (e) => {
e.preventDefault(); // this stops whatever the browser wanted to do itself.
const form = $(e.target).serializeArray();
console.log("eventListener");
fetch("https://api.spotify.com/v1/audio-analysis/6EJiVf7U0p1BBfs0qqeb1f", {
method: "GET",
headers: {
Authorization: `Bearer ${userAccessToken}`
}
})
.then(response => response.json())
.then(({beats})) => {
beats.forEach((beat, index) => {
console.log(`Beat ${index} starts at ${beat.start}`);
})
}

.catch((err) => {
console.log(err);
});
});
</script> -->

</body>
</html>
